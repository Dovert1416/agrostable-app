<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üå± AgroStable</title>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #e0f7fa 0%, #e8f5e9 100%);
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      line-height: 1.6;
    }
    
    /* SELECTOR DE IDIOMAS */
    .language-selector {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(255,255,255,0.95);
        padding: 10px 15px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        border: 1px solid rgba(76,175,80,0.2);
        backdrop-filter: blur(10px);
    }
    .language-selector select {
        background: transparent;
        border: none;
        padding: 5px 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        color: #2E7D32;
        outline: none;
    }
    
    /* HERO SECTION */
    .hero {
      background: linear-gradient(135deg, rgba(46,125,50,0.92) 0%, rgba(25,118,210,0.88) 100%), url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80') center/cover no-repeat;
      color: #fff;
      min-height: 120vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 180px 24px 60px 24px;
      position: relative;
      border-radius: 0 0 40px 40px;
      margin-bottom: 0;
      box-shadow: 0 8px 32px rgba(67,233,123,0.08);
      overflow: hidden;
      width: 100%;
      box-sizing: border-box;
    }
    .hero-title {
      font-size: 3.2rem;
      font-weight: 800;
      margin-bottom: 24px;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 18px;
      color: #fff;
      text-shadow: 0 2px 16px rgba(46,125,50,0.18);
      max-width: 1000px;
      line-height: 1.2;
    }
    .hero-subtitle {
      font-size: 1.7rem;
      font-weight: 500;
      margin-bottom: 20px;
      color: #e0f2f1;
      text-shadow: 0 1px 8px rgba(25,118,210,0.13);
      max-width: 800px;
    }
    .hero-desc {
      font-size: 1.25rem;
      font-weight: 400;
      margin-bottom: 40px;
      color: #e3fcec;
      text-shadow: 0 1px 8px rgba(25,118,210,0.10);
      max-width: 700px;
      line-height: 1.5;
    }
    .hero-cta {
      background: linear-gradient(135deg, #4CAF50 0%, #1976D2 100%);
      color: #fff;
      border: none;
      border-radius: 18px;
      padding: 22px 60px;
      font-size: 1.35rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(33,150,243,0.10);
      transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
      margin: 20px 0 40px 0;
      letter-spacing: 0.5px;
    }
    .hero-cta:hover {
      background: linear-gradient(135deg, #388e3c 0%, #1976d2 100%);
      transform: translateY(-2px) scale(1.04);
      box-shadow: 0 8px 32px rgba(33,150,243,0.18);
    }
    
    /* Estad√≠sticas HERO */
    .hero-stats {
      display: flex;
      gap: 40px;
      justify-content: center;
      margin-top: 48px;
      flex-wrap: wrap;
      animation: fadeInUp 1.2s cubic-bezier(.23,1.01,.32,1) both;
      max-width: 900px;
    }
    .hero-stat {
      background: rgba(255,255,255,0.13);
      border-radius: 16px;
      padding: 22px 36px;
      color: #fff;
      font-size: 1.18rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(33,150,243,0.10);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 180px;
      margin-bottom: 8px;
      backdrop-filter: blur(2px);
    }
    .hero-stat-icon {
      font-size: 2.2rem;
      margin-right: 8px;
    }
    
    /* SECCIONES */
    .section {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 0 auto;
      padding: 80px 24px 80px 24px;
      box-sizing: border-box;
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.06);
      margin-bottom: 80px;
      background: #fff;
    }
    .section.bg-alt {
      background: #f7fafc;
      box-shadow: 0 4px 16px rgba(0,0,0,0.04);
    }
    
    /* QU√â ANALIZAMOS */
    .analizamos-cards {
      display: flex;
      gap: 32px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 32px;
      margin-bottom: 0;
    }
    .analizamos-card {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 18px rgba(76,175,80,0.07);
      padding: 44px 32px 44px 32px;
      flex: 1 1 260px;
      min-width: 260px;
      max-width: 370px;
      text-align: center;
      margin-bottom: 16px;
      transition: box-shadow 0.2s, transform 0.2s;
      border: 2px solid #e0f2f1;
      animation: fadeInUp 1.1s cubic-bezier(.23,1.01,.32,1) both;
      min-height: 370px;
    }
    .analizamos-card:hover {
      box-shadow: 0 8px 32px rgba(33,150,243,0.13);
      transform: translateY(-4px) scale(1.03);
      border-color: #b2dfdb;
    }
    .analizamos-icon {
      font-size: 3.5rem;
      margin-bottom: 18px;
      display: block;
    }
    .analizamos-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 10px;
      color: #2E7D32;
      letter-spacing: 0.2px;
    }
    .analizamos-desc {
      font-size: 1.08rem;
      color: #222;
      margin-bottom: 8px;
      line-height: 1.6;
      text-align: left;
    }
    
    /* SECCI√ìN TECNOLOG√çA */
    .funciona-steps {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 32px;
      margin-top: 32px;
      justify-content: center;
      width: 100%;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }
    @media (max-width: 1024px) {
      .funciona-steps { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 600px) {
      .funciona-steps { grid-template-columns: 1fr; }
    }
    .funciona-step {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 16px rgba(25,118,210,0.10);
      padding: 30px 18px 30px 18px;
      min-width: 200px;
      max-width: 320px;
      text-align: center;
      margin-bottom: 12px;
      border: 2px solid #e3f2fd;
      transition: box-shadow 0.2s, transform 0.2s, border-color 0.2s;
      animation: fadeInUp 1.1s cubic-bezier(.23,1.01,.32,1) both;
    }
    .funciona-step:hover {
      box-shadow: 0 8px 32px rgba(76,175,80,0.13);
      transform: translateY(-4px) scale(1.03);
      border-color: #b3e5fc;
    }
    .funciona-step-num {
      font-size: 2.7rem;
      font-weight: 800;
      color: #1976D2;
      margin-bottom: 18px;
      display: block;
    }
    .funciona-step-icon {
      font-size: 3.5rem;
      margin-bottom: 10px;
      display: block;
    }
    .funciona-step-desc {
      font-size: 1.18rem;
      color: #333;
      font-weight: 500;
    }
    
    /* Estad√≠sticas tecnolog√≠a */
    .funciona-datos {
      margin-top: 36px;
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
      justify-content: center;
      animation: fadeInUp 1.2s cubic-bezier(.23,1.01,.32,1) both;
    }
    .funciona-dato {
      background: #e3f2fd;
      color: #1976d2;
      border-radius: 12px;
      padding: 16px 24px;
      font-size: 1.18rem;
      font-weight: 600;
      margin-bottom: 8px;
      min-width: 180px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(33,150,243,0.06);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .funciona-dato-icon {
      font-size: 2rem;
      margin-right: 8px;
    }
    
    /* Cultivos soportados */
    .cultivos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 18px;
      margin-top: 32px;
      margin-bottom: 0;
    }
    .cultivo-item {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(76,175,80,0.07);
      padding: 16px 0;
      text-align: center;
      font-size: 1.08rem;
      font-weight: 600;
      color: #388e3c;
      border: 2px solid #e0f2f1;
      transition: box-shadow 0.2s, transform 0.2s, border-color 0.2s;
    }
    .cultivo-item:hover {
      box-shadow: 0 8px 32px rgba(33,150,243,0.13);
      transform: translateY(-2px) scale(1.04);
      border-color: #b2dfdb;
    }
    
    /* Formulario y resultados */
    .main-container {
      max-width: 900px;
      width: 100%;
      background: linear-gradient(145deg, #ffffff 0%, #f8f6ff 100%);
      box-shadow: 0 12px 40px rgba(94, 53, 177, 0.15);
      border: 1px solid rgba(94, 53, 177, 0.08);
      border-radius: 20px;
      padding: 60px 40px 60px 40px;
      margin: 0 auto 48px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;
    }
    .form-section-title {
      font-size: 2rem;
      font-weight: 700;
      color: #2E7D32;
      margin-bottom: 32px;
      text-align: center;
    }
    .form-group {
      margin-bottom: 20px;
      width: 100%;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2E7D32;
      font-size: 16px;
    }
    input, select {
      width: 100%;
      padding: 16px 20px;
      border-radius: 12px;
      border: 2px solid #E8F5E8;
      font-size: 16px;
      display: block;
      box-sizing: border-box;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 3px rgba(76,175,80,0.1);
    }
    .form-actions {
      grid-column: 1 / -1;
      display: flex;
      gap: 20px;
      margin-top: 8px;
      justify-content: center;
      width: 100%;
    }
    button[type="submit"] {
      background: linear-gradient(135deg, #4CAF50 0%, #1976D2 100%);
      color: #fff;
      border: none;
      border-radius: 16px;
      padding: 20px 60px;
      font-size: 20px;
      font-weight: 700;
      width: 100%;
      margin-top: 24px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s, background 0.2s;
      box-shadow: 0 2px 8px rgba(76, 175, 80, 0.08);
      letter-spacing: 0.5px;
    }
    button[type="submit"]:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
      background: linear-gradient(135deg, #388e3c 0%, #1976d2 100%);
    }
    button#clear-btn {
      background: #F44336;
      color: #fff;
      border: none;
      border-radius: 16px;
      padding: 20px 60px;
      font-size: 20px;
      font-weight: 700;
      width: 100%;
      margin-top: 24px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(244, 67, 54, 0.08);
      letter-spacing: 0.5px;
    }
    button#clear-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(244, 67, 54, 0.18);
    }
    
    /* Animaciones */
    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(30px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .hero-title { font-size: 2rem; }
      .hero-subtitle { font-size: 1.2rem; }
      .hero-desc { font-size: 1.1rem; }
    }
    
    /* Navegaci√≥n suave */
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body>
  <!-- SELECTOR DE IDIOMAS -->
  <div class="language-selector">
    <select id="languageSelect">
        <option value="es">üá™üá∏ Espa√±ol</option>
        <option value="en">üá∫üá∏ English</option>
        <option value="pt">üáµüáπ Portugu√™s</option>
        <option value="fr">üá´üá∑ Fran√ßais</option>
        <option value="it">üáÆüáπ Italiano</option>
    </select>
  </div>
  
  <!-- HERO SECTION -->
  <section class="hero" id="hero">
    <div class="hero-title"><span class="icon">üå±</span>AgroStable - An√°lisis Satelital Agr√≠cola Inteligente</div>
    <div class="hero-subtitle">Previene p√©rdidas en tu cultivo con datos satelitales en tiempo real</div>
    <div class="hero-desc">Analiza la salud de tu plantaci√≥n, condiciones clim√°ticas y estabilidad del suelo usando tecnolog√≠a espacial de √∫ltima generaci√≥n</div>
    <button class="hero-cta" onclick="document.getElementById('form-section').scrollIntoView({behavior:'smooth'})">Analizar mi finca gratis</button>
    <div class="hero-stats">
      <div class="hero-stat"><span class="hero-stat-icon">üì°</span><span>15+ cultivos analizados</span></div>
      <div class="hero-stat"><span class="hero-stat-icon">üõ∞Ô∏è</span><span>10m resoluci√≥n espacial</span></div>
      <div class="hero-stat"><span class="hero-stat-icon">‚è±Ô∏è</span><span>30 segundos an√°lisis</span></div>
      <div class="hero-stat"><span class="hero-stat-icon">üìä</span><span><5% margen error</span></div>
    </div>
  </section>

  <!-- QU√â ANALIZAMOS -->
  <section class="section" id="analizamos">
    <h2 style="text-align:center; color:#2E7D32; font-size:2rem; font-weight:700; margin-bottom:18px;">¬øQu√© analizamos en tu finca?</h2>
    <div class="analizamos-cards">
      <div class="analizamos-card">
        <span class="analizamos-icon">üå±</span>
        <div class="analizamos-title">NDVI - Salud de Plantas</div>
        <div class="analizamos-desc">Usando im√°genes multiespectrales de Sentinel-2, medimos la reflectancia infrarroja de tus cultivos. Valores altos indican vegetaci√≥n densa y saludable, mientras valores bajos revelan estr√©s h√≠drico, deficiencias nutricionales, plagas o enfermedades. Nuestro algoritmo compara tu NDVI con rangos √≥ptimos espec√≠ficos para cada cultivo.</div>
      </div>
      <div class="analizamos-card">
        <span class="analizamos-icon">üå§Ô∏è</span>
        <div class="analizamos-title">Condiciones Clim√°ticas</div>
        <div class="analizamos-desc">Datos meteorol√≥gicos actualizados cada hora desde estaciones globales: temperatura ambiente, humedad relativa, velocidad del viento y condiciones atmosf√©ricas. Evaluamos si tu microclima actual favorece el crecimiento de tu cultivo espec√≠fico seg√∫n par√°metros agron√≥micos establecidos.</div>
      </div>
      <div class="analizamos-card">
        <span class="analizamos-icon">üèîÔ∏è</span>
        <div class="analizamos-title">Estabilidad del Suelo</div>
        <div class="analizamos-desc">Tecnolog√≠a radar de apertura sint√©tica (SAR) de Sentinel-1 detecta movimientos milim√©tricos del terreno. Medimos subsidencia, expansi√≥n del suelo y microdeformaciones que pueden afectar sistemas de riego, estructuras agr√≠colas y desarrollo radicular de tus plantas.</div>
      </div>
    </div>
  </section>

  <!-- C√ìMO FUNCIONA -->
  <section class="section bg-alt" id="funciona">
    <h2 style="text-align:center; color:#1976d2; font-size:2rem; font-weight:700; margin-bottom:18px;">Tecnolog√≠a satelital al servicio de tu finca</h2>
    <div class="funciona-steps">
      <div class="funciona-step">
        <span class="funciona-step-icon">üìç</span>
        <span class="funciona-step-num">1</span>
        <div class="funciona-step-desc">Ingresa las coordenadas de tu finca</div>
      </div>
      <div class="funciona-step">
        <span class="funciona-step-icon">üõ∞Ô∏è</span>
        <span class="funciona-step-num">2</span>
        <div class="funciona-step-desc">Nuestros algoritmos consultan sat√©lites Sentinel en tiempo real</div>
      </div>
      <div class="funciona-step">
        <span class="funciona-step-icon">üì°</span>
        <span class="funciona-step-num">3</span>
        <div class="funciona-step-desc">Recibes an√°lisis detallado con recomendaciones espec√≠ficas</div>
      </div>
      <div class="funciona-step">
        <span class="funciona-step-icon">üìä</span>
        <span class="funciona-step-num">4</span>
        <div class="funciona-step-desc">Visualiza la ubicaci√≥n analizada en mapa interactivo</div>
      </div>
    </div>
    <div class="funciona-datos">
      <div class="funciona-dato"><span class="funciona-dato-icon">üì°</span><span>Cobertura: Mundial</span></div>
      <div class="funciona-dato"><span class="funciona-dato-icon">üõ∞Ô∏è</span><span>Resoluci√≥n: hasta 10 metros</span></div>
      <div class="funciona-dato"><span class="funciona-dato-icon">üå±</span><span>15 cultivos soportados</span></div>
      <div class="funciona-dato"><span class="funciona-dato-icon">‚è±Ô∏è</span><span>An√°lisis en menos de 30 segundos</span></div>
    </div>
  </section>

  <!-- CULTIVOS SOPORTADOS -->
  <section class="section" id="cultivos">
    <h2 style="text-align:center; color:#2E7D32; font-size:2rem; font-weight:700; margin-bottom:18px;">Cultivos analizados</h2>
    <div class="cultivos-grid">
      <div class="cultivo-item">Caf√©</div>
      <div class="cultivo-item">Tomate</div>
      <div class="cultivo-item">Ma√≠z</div>
      <div class="cultivo-item">Arroz</div>
      <div class="cultivo-item">Papa</div>
      <div class="cultivo-item">Frijol</div>
      <div class="cultivo-item">Cebolla</div>
      <div class="cultivo-item">Lechuga</div>
      <div class="cultivo-item">Pl√°tano</div>
      <div class="cultivo-item">Ca√±a de az√∫car</div>
      <div class="cultivo-item">Cacao</div>
      <div class="cultivo-item">Yuca</div>
      <div class="cultivo-item">Flores</div>
      <div class="cultivo-item">Trigo</div>
      <div class="cultivo-item">Aguacate</div>
    </div>
  </section>

  <!-- FORMULARIO Y RESULTADOS -->
  <section class="section bg-alt" id="form-section" style="padding-left:24px; padding-right:24px; margin:60px auto 80px auto;">
    <div class="form-section-title">Analiza tu finca ahora</div>
    <div class="main-container">
      <div class="header">
        <div class="logo"><span class="icon">üå±</span>AgroStable</div>
        <div class="subtitle">An√°lisis Satelital Agr√≠cola Inteligente</div>
      </div>
      <form id="farm-form" style="width:100%; max-width:600px; margin:0 auto; display:block; background:none; box-shadow:none; padding:0; border-radius:0;">
        <div class="form-group">
          <label for="farm-name">Nombre de la finca</label>
          <input type="text" id="farm-name" name="farm-name" required>
        </div>
        <div class="form-group">
          <label for="latitud">Latitud</label>
          <input type="number" id="latitud" name="latitude" step="any" required>
        </div>
        <div class="form-group">
          <label for="longitud">Longitud</label>
          <input type="number" id="longitud" name="longitude" step="any" required>
        </div>
        <div class="form-group">
          <label for="crop-type">Tipo de cultivo</label>
          <select id="crop-type" name="crop-type" required>
            <option value="">Seleccione...</option>
            <option value="Caf√©">Caf√©</option>
            <option value="Tomate">Tomate</option>
            <option value="Ma√≠z">Ma√≠z</option>
            <option value="Arroz">Arroz</option>
            <option value="Papa">Papa</option>
            <option value="Frijol">Frijol</option>
            <option value="Cebolla">Cebolla</option>
            <option value="Lechuga">Lechuga</option>
            <option value="Pl√°tano">Pl√°tano</option>
            <option value="Ca√±a de az√∫car">Ca√±a de az√∫car</option>
            <option value="Cacao">Cacao</option>
            <option value="Yuca">Yuca</option>
            <option value="Flores">Flores</option>
            <option value="Trigo">Trigo</option>
            <option value="Aguacate">Aguacate</option>
          </select>
        </div>
        <div class="form-actions" style="display:flex; gap:20px; margin-top:8px; justify-content:center;">
          <button type="submit">Analizar Finca</button>
          <button type="button" id="clear-btn">Limpiar</button>
        </div>
      </form>
      <section id="resultados">
        <div id="result-map" style="height: 300px; border-radius: 12px; margin: 20px 0; display: none;"></div>
        <div id="resultados-lista"></div>
      </section>
    </div>
  </section>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const form = document.getElementById('farm-form');
    const resultados = document.getElementById('resultados');
    const resultadosLista = document.getElementById('resultados-lista');
    const clearBtn = document.getElementById('clear-btn');

    // LEAFLET MAPA DE RESULTADO
    let resultMap = null;
    let resultMarker = null;
    function mostrarMapaResultado(lat, lng) {
      const mapDiv = document.getElementById('result-map');
      mapDiv.style.display = 'block';
      mapDiv.innerHTML = '';
      
      if (!document.getElementById('result-map-title')) {
        const title = document.createElement('div');
        title.id = 'result-map-title';
        title.textContent = 'üìç Ubicaci√≥n Analizada';
        title.style.fontWeight = '600';
        title.style.fontSize = '18px';
        title.style.marginBottom = '8px';
        mapDiv.parentNode.insertBefore(title, mapDiv);
      }
      
      resultMap = L.map('result-map').setView([lat, lng], 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(resultMap);
      resultMarker = L.marker([lat, lng]).addTo(resultMap);
    }

    // SUBMIT DEL FORMULARIO CON API CORREGIDA
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      try {
        const nombre = document.getElementById('farm-name').value.trim();
        const lat = document.getElementById('latitud').value.trim();
        const lon = document.getElementById('longitud').value.trim();
        const cultivo = document.getElementById('crop-type').value;
        
        if (!nombre || !lat || !lon || !cultivo) {
          alert('Por favor, complete todos los campos.');
          return;
        }
        
        resultadosLista.innerHTML = '<li>üîÑ Analizando datos satelitales y clim√°ticos...</li>';
        resultados.style.display = 'block';
        
        // LLAMADA A LA API CORREGIDA
        const response = await fetch('/api/test', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            latitude: parseFloat(lat),
            longitude: parseFloat(lon),
            cropType: cultivo
          })
        });

        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }

        const data = await response.json();
        
        // Mostrar resultados de la API mejorada
        let ndviText = 'N/A - Sin datos';
        let climaText = 'N/A';
        let subsidenciaText = 'Sin datos';
        let scoreText = 'N/A';
        
        // NDVI con estado inteligente
        if (data.ndvi !== null && data.ndvi !== undefined) {
          const ndviPercent = Math.round(data.ndvi * 100);
          let estado = data.analysis?.ndvi?.status || 'REGULAR';
          ndviText = `${data.ndvi.toFixed(2)} (${ndviPercent}%) - ${estado}`;
        }
        
        // Clima mejorado
        if (data.climate) {
          const temp = data.climate.temperature || 'N/A';
          const humidity = data.climate.humidity || 'N/A';
          const desc = data.climate.description || '';
          climaText = `${temp}¬∞C, Humedad: ${humidity}% ${desc ? '(' + desc + ')' : ''}`;
        }
        
        // Subsidencia con an√°lisis
        if (data.subsidence !== null && data.subsidence !== undefined) {
          let subsidenciaEstado = data.analysis?.subsidence?.status || 'SIN AN√ÅLISIS';
          subsidenciaText = `${data.subsidence} mm/a√±o - ${subsidenciaEstado}`;
        }
        
        // Puntuaci√≥n final
        if (data.score !== null && data.score !== undefined) {
          let scoreLevel = '';
          if (data.score >= 80) scoreLevel = 'EXCELENTE';
          else if (data.score >= 60) scoreLevel = 'BUENO';
          else if (data.score >= 40) scoreLevel = 'REGULAR';
          else scoreLevel = 'CR√çTICO';
          
          scoreText = `${Math.round(data.score)}/100 (${scoreLevel})`;
        }
        
        const recommendations = data.recommendations || ['Mantener monitoreo regular', 'Seguir buenas pr√°cticas agr√≠colas'];
        
        // Generar rangos NDVI espec√≠ficos por cultivo
        let ndviRanges = '';
        if (cultivo === 'Caf√©') {
          ndviRanges = `
            <strong>Rangos NDVI para Caf√©:</strong><br>
            ‚Ä¢ 0.80 - 1.00: Excelente (vegetaci√≥n densa)<br>
            ‚Ä¢ 0.60 - 0.79: Bueno (vegetaci√≥n saludable)<br>
            ‚Ä¢ 0.40 - 0.59: Regular (estr√©s moderado)<br>
            ‚Ä¢ 0.20 - 0.39: Malo (estr√©s severo)<br>
            ‚Ä¢ 0.00 - 0.19: Cr√≠tico (suelo desnudo o vegetaci√≥n muerta)
          `;
        } else if (cultivo === 'Tomate') {
          ndviRanges = `
            <strong>Rangos NDVI para Tomate:</strong><br>
            ‚Ä¢ 0.75 - 1.00: Excelente (vegetaci√≥n densa)<br>
            ‚Ä¢ 0.55 - 0.74: Bueno (vegetaci√≥n saludable)<br>
            ‚Ä¢ 0.35 - 0.54: Regular (estr√©s moderado)<br>
            ‚Ä¢ 0.15 - 0.34: Malo (estr√©s severo)<br>
            ‚Ä¢ 0.00 - 0.14: Cr√≠tico (suelo desnudo o vegetaci√≥n muerta)
          `;
        } else {
          ndviRanges = `
            <strong>Rangos NDVI para ${cultivo}:</strong><br>
            ‚Ä¢ 0.80 - 1.00: Excelente<br>
            ‚Ä¢ 0.60 - 0.79: Bueno<br>
            ‚Ä¢ 0.40 - 0.59: Regular<br>
            ‚Ä¢ 0.20 - 0.39: Malo<br>
            ‚Ä¢ 0.00 - 0.19: Cr√≠tico
          `;
        }

        // Explicaci√≥n de puntuaci√≥n detallada
        let scoreExplanation = '';
        if (data.analysis) {
          scoreExplanation = '<br><strong>¬øPor qu√© esta puntuaci√≥n?</strong><br>';
          if (data.analysis.ndvi) {
            scoreExplanation += `‚Ä¢ <strong>NDVI ${data.analysis.ndvi.status}</strong> (-${data.analysis.ndvi.penalty} puntos): `;
            if (data.analysis.ndvi.status === 'CR√çTICO') scoreExplanation += 'Vegetaci√≥n muy escasa o suelo desnudo.';
            else if (data.analysis.ndvi.status === 'BUENO') scoreExplanation += 'Vegetaci√≥n saludable.';
            else if (data.analysis.ndvi.status === 'EXCELENTE') scoreExplanation += 'Vegetaci√≥n √≥ptima y densa.';
            else scoreExplanation += 'Estado de vegetaci√≥n intermedio.';
            scoreExplanation += '<br>';
          }
          if (data.analysis.subsidence) {
            scoreExplanation += `‚Ä¢ <strong>Subsidencia ${data.analysis.subsidence.status}</strong> (-${data.analysis.subsidence.penalty} puntos): `;
            if (data.analysis.subsidence.status === 'CR√çTICO') scoreExplanation += 'Terreno inestable amenaza la infraestructura.';
            else if (data.analysis.subsidence.status === 'ESTABLE') scoreExplanation += 'Terreno completamente estable.';
            else scoreExplanation += 'Ligera inestabilidad del terreno.';
            scoreExplanation += '<br>';
          }
          if (data.analysis.temperature) {
            const tempPenalty = data.analysis.temperature.penalty || 0;
            if (tempPenalty > 0) {
              scoreExplanation += `‚Ä¢ <strong>Temperatura</strong> (-${tempPenalty} puntos): Fuera del rango √≥ptimo para ${cultivo}.<br>`;
            }
          }
          if (data.analysis.humidity) {
            const humPenalty = data.analysis.humidity.penalty || 0;
            if (humPenalty > 0) {
              scoreExplanation += `‚Ä¢ <strong>Humedad</strong> (-${humPenalty} puntos): Nivel inadecuado para ${cultivo}.<br>`;
            }
          }
        }

        resultadosLista.innerHTML = `
          <div style="line-height: 1.6; color: #333;">
            <div style="margin-bottom: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
              <h4 style="margin: 0 0 10px 0; color: #2E7D32;">üå± NDVI: ${ndviText}</h4>
              <p style="margin: 8px 0;"><strong>Tu plantaci√≥n de ${cultivo} est√° en estado ${data.analysis?.ndvi?.status?.toLowerCase() || 'desconocido'}.</strong></p>
              <p style="margin: 8px 0;"><strong>¬øQu√© significa esto?</strong><br>
              El NDVI (√çndice de Vegetaci√≥n de Diferencia Normalizada) indica el vigor y salud de la vegetaci√≥n. Valores altos significan plantas sanas y densas; valores bajos indican estr√©s, escasez o muerte vegetal.</p>
              <p style="margin: 8px 0;"><strong>¬øDe d√≥nde sale este dato?</strong><br>
              Analizamos tu finca con m√∫ltiples im√°genes satelitales (Sentinel-2) de los √∫ltimos 30 d√≠as que miden el "verdor" de las plantas usando bandas del espectro visible e infrarrojo.</p>
              <div style="margin: 10px 0; font-size: 14px; background: #e8f5e8; padding: 10px; border-radius: 5px;">
                ${ndviRanges}
              </div>
            </div>

            <div style="margin-bottom: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
              <h4 style="margin: 0 0 10px 0; color: #1976D2;">üå°Ô∏è Condiciones clim√°ticas: ${climaText}</h4>
              <p style="margin: 8px 0;"><strong>An√°lisis clim√°tico para ${cultivo}:</strong></p>
              ${data.climate ? `
                <p style="margin: 5px 0;">‚Ä¢ Temperatura: ${data.climate.temperature}¬∞C - ${data.climate.temperature >= 18 && data.climate.temperature <= 26 ? '√ìPTIMA' : 'FUERA DEL RANGO'} para ${cultivo} (ideal: 18-26¬∞C).</p>
                <p style="margin: 5px 0;">‚Ä¢ Humedad: ${data.climate.humidity}% - ${data.climate.humidity >= 60 && data.climate.humidity <= 80 ? 'ADECUADA' : 'INADECUADA'} para ${cultivo} (ideal: 60-80%).</p>
              ` : '<p>Datos clim√°ticos no disponibles</p>'}
            </div>

            <div style="margin-bottom: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
              <h4 style="margin: 0 0 10px 0; color: #795548;">üèîÔ∏è Subsidencia: ${subsidenciaText}</h4>
              <p style="margin: 8px 0;"><strong>¬øQu√© es subsidencia?</strong><br>
              La subsidencia es el hundimiento gradual del terreno, que puede afectar la estabilidad de cultivos y estructuras agr√≠colas.</p>
              <p style="margin: 8px 0;"><strong>¬øC√≥mo lo medimos?</strong><br>
              Usamos radares satelitales (Sentinel-1) que detectan cambios milim√©tricos en la altura del suelo a lo largo del tiempo.</p>
              <div style="margin: 10px 0; font-size: 14px; background: #e8f5e8; padding: 10px; border-radius: 5px;">
                <strong>Rangos de subsidencia:</strong><br>
                ‚Ä¢ 0-1 mm/a√±o: Estable<br>
                ‚Ä¢ 1-3 mm/a√±o: Ligeramente inestable<br>
                ‚Ä¢ 3-6 mm/a√±o: Inestable<br>
                ‚Ä¢ >6 mm/a√±o: Cr√≠tico
              </div>
            </div>

            <div style="margin-bottom: 25px; padding: 15px; background: #f0f8ff; border-radius: 8px;">
              <h4 style="margin: 0 0 10px 0; color: #1976D2;">üéØ Recomendaciones espec√≠ficas:</h4>
              <ul style="margin: 8px 0; padding-left: 20px; line-height: 1.5;">
                ${recommendations.map(r => `<li style="margin-bottom: 8px;">${r}</li>`).join('')}
              </ul>
            </div>

            <div style="margin-bottom: 25px; padding: 15px; background: #fff3e0; border-radius: 8px;">
              <h4 style="margin: 0 0 10px 0; color: #F57C00;">üìä Puntuaci√≥n general: ${scoreText}</h4>
              ${scoreExplanation}
            </div>

            <div style="margin-bottom: 25px; padding: 15px; background: #f3e5f5; border-radius: 8px;">
              <h4 style="margin: 0 0 10px 0; color: #7B1FA2;">üìö GLOSARIO:</h4>
              <p style="margin: 5px 0; font-size: 14px;"><strong>NDVI:</strong> √çndice de Vegetaci√≥n que mide el verdor y salud de las plantas (0-1, m√°s alto = m√°s sano).</p>
              <p style="margin: 5px 0; font-size: 14px;"><strong>Subsidencia:</strong> Hundimiento gradual del terreno, medido en mil√≠metros por a√±o.</p>
              <p style="margin: 5px 0; font-size: 14px;"><strong>Sentinel-2:</strong> Sat√©lite europeo que provee im√°genes multiespectrales para agricultura.</p>
              <p style="margin: 5px 0; font-size: 14px;"><strong>Sentinel-1:</strong> Sat√©lite radar que detecta cambios en la superficie terrestre.</p>
            </div>
          </div>
        `;
        
        resultados.style.display = 'block';
        resultados.scrollIntoView({behavior:'smooth'});
        
        if (!isNaN(parseFloat(lat)) && !isNaN(parseFloat(lon))) {
          mostrarMapaResultado(parseFloat(lat), parseFloat(lon));
        }
      } catch (err) {
        console.error('Error en el an√°lisis:', err);
        resultadosLista.innerHTML = '<li>‚ùå Error al consultar los datos. Intenta de nuevo m√°s tarde.</li>';
      }
    });

    // Limpiar formulario
    clearBtn.addEventListener('click', function() {
      form.reset();
      resultados.style.display = 'none';
      resultadosLista.innerHTML = '';
    });
  </script>
</body>
</html>
